#******************************************************
#    WebUI
#    Port: 443
#******************************************************
server {

    listen 443 ssl;
    client_max_body_size 512M;

    # OpenTakServer certificates
    include includes.d/opentakserver_certificate;

    #******************************************************
    #       Docker Healthcheck
    #******************************************************
    location = /health {
        access_log off;
        add_header 'Content-Type' 'application/json';
        return 200 '{"status":"healthy"}';
    }

    #******************************************************
    #       OpenTakServer WebUI
    #******************************************************
    location / {
        include includes.d/proxy_params;
        proxy_pass http://webui;
    }

    #******************************************************
    #       OpenTakServer API
    #******************************************************
    location /api {
        include includes.d/proxy_params;
        proxy_pass http://opentakserver;
    }

    location /socket.io {
        include includes.d/proxy_params;
        proxy_http_version 1.1;
        proxy_buffering off;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_pass http://opentakserver/socket.io;
    }

}
